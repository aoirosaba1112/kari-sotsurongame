<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ã‚³ã‚¤ãƒ³ãƒˆã‚¹ã‚²ãƒ¼ãƒ ï¼ˆæ™‚é–“åˆ¶é™ï¼‹ç¢ºç‡è¡¨ç¤ºï¼‹ãƒ•ã‚©ãƒ¼ãƒ é·ç§»ï¼‰</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
<style>
  :root{
    --bg:#ffffff;
    --panel:#f6f7fb;
    --primary:#0b84ff;
    --accent:#00a86b;
    --danger:#e03b3b;
    --muted:#666;
  }
  body{margin:0;font-family:"Meiryo",sans-serif;background:var(--bg);}
  header,footer{text-align:center;padding:10px;color:var(--muted);}
  #app{display:flex;flex-direction:column;align-items:center;min-height:100vh;}
  .screen{display:none;flex-direction:column;align-items:center;width:100%;max-width:520px;padding:12px;box-sizing:border-box;}
  .active{display:flex;}
  .card{background:var(--panel);border-radius:12px;padding:12px;box-shadow:0 2px 6px rgba(0,0,0,0.05);margin-bottom:12px;width:100%;}
  .big-btn{padding:14px;border-radius:12px;border:0;font-size:20px;color:#fff;width:45%;}
  .btn-primary{background:var(--primary);}
  .btn-accent{background:var(--accent);}
  .btn-danger{background:var(--danger);}
  .btn-end{background:#555;}
  .btn-row{display:flex;gap:10px;justify-content:center;margin-top:10px;}
  #probability{font-size:14px;color:#444;margin-top:8px;text-align:center;}
  #timer.red{color:red;font-weight:bold;}
</style>
</head>
<body>
<div id="app">
  <header><h2>ã‚³ã‚¤ãƒ³ãƒˆã‚¹ã‚²ãƒ¼ãƒ ï¼ˆæ™‚é–“åˆ¶é™ä»˜ãï¼‰</h2></header>

  <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
  <div id="title" class="screen active">
    <div class="card" style="text-align:center;">
      <h3>ã‚³ã‚¤ãƒ³ãƒˆã‚¹ã‚²ãƒ¼ãƒ </h3>
      <p>åˆ¶é™æ™‚é–“ï¼š15ç§’</p>
      <button id="start" class="big-btn btn-primary">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </div>
  </div>

  <!-- ã‚²ãƒ¼ãƒ  -->
  <div id="game" class="screen">
    <div class="card" style="text-align:center;">
      <div id="p5target" style="width:100%;aspect-ratio:3/2;"></div>
    </div>

    <div class="card">
      <div>æ‰€æŒãƒã‚¤ãƒ³ãƒˆï¼š<span id="money">0</span>pt</div>
      <div>å›æ•°ï¼š<span id="count">0</span>å›</div>
      <div>æ®‹ã‚Šæ™‚é–“ï¼š<span id="timer">15</span>ç§’</div>
      <div id="message" style="margin-top:8px;color:#333;">è¡¨ã‹è£ã‚’é¸ã‚“ã§ãã ã•ã„ï¼</div>
      <div class="btn-row">
        <button id="heads" class="big-btn btn-accent">è¡¨</button>
        <button id="tails" class="big-btn btn-danger">è£</button>
      </div>
      <div class="btn-row">
        <button id="end" class="big-btn btn-end" style="width:95%;">çµ‚äº†</button>
      </div>
      <div id="probability">
        ğŸ¯ å ±é…¬ç¢ºç‡ï¼š1%ï¼10pt ï½œ 79.5%ï¼1pt ï½œ 19.5%ï¼3pt
      </div>
    </div>

    <div class="card" id="history-area"></div>
  </div>

  <!-- ãƒªã‚¶ãƒ«ãƒˆ -->
  <div id="result" class="screen">
    <div class="card" style="text-align:center;">
      <h3>ãƒªã‚¶ãƒ«ãƒˆ</h3>
      <p id="timeup-msg" style="color:red;display:none;">â° æ™‚é–“åˆ‡ã‚Œã§ã™ï¼</p>
      <p>ãƒ—ãƒ¬ã‚¤å›æ•°ï¼š<span id="result-count"></span>å›</p>
      <p>å½“ãŸã‚Šå›æ•°ï¼š<span id="result-win"></span>å›</p>
      <p>ã¯ãšã‚Œå›æ•°ï¼š<span id="result-lose"></span>å›</p>
      <p>æœ€çµ‚ãƒã‚¤ãƒ³ãƒˆï¼š<span id="result-money"></span>pt</p>
      <p>å‹ç‡ï¼š<span id="result-rate"></span>%</p>
      <div class="btn-row">
        <button id="formBtn" class="big-btn btn-primary" style="width:95%;">å›ç­”ãƒ•ã‚©ãƒ¼ãƒ ã¸é€²ã‚€</button>
      </div>
    </div>
  </div>

  <footer>Â© 2025 ã‚³ã‚¤ãƒ³ãƒˆã‚¹ã‚²ãƒ¼ãƒ  Webç‰ˆ</footer>
</div>

<!-- ğŸ”Š åŠ¹æœéŸ³ -->
<audio id="warnSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

<script>
let points=0,count=0,winCount=0,loseCount=0;
let animating=false,animProgress=0,face='è¡¨',coinResult=null,choice=null;
let timeLeft=15; // 15ç§’åˆ¶é™
let timerId=null, warned=false;

const title=document.getElementById('title');
const game=document.getElementById('game');
const result=document.getElementById('result');
const startBtn=document.getElementById('start');
const heads=document.getElementById('heads');
const tails=document.getElementById('tails');
const endBtn=document.getElementById('end');
const moneyLabel=document.getElementById('money');
const countLabel=document.getElementById('count');
const timerLabel=document.getElementById('timer');
const messageLabel=document.getElementById('message');
const warnSound=document.getElementById('warnSound');
const formBtn=document.getElementById('formBtn');

function show(name){
  [title,game,result].forEach(s=>s.classList.remove('active'));
  document.getElementById(name).classList.add('active');
}

startBtn.onclick=()=>{show('game');startTimer();};
heads.onclick=()=>flip('è¡¨');
tails.onclick=()=>flip('è£');
endBtn.onclick=()=>endGame();
formBtn.onclick=()=>{
  // Googleãƒ•ã‚©ãƒ¼ãƒ ã®URLã«å¤‰æ›´ã—ã¦ãã ã•ã„
  window.location.href='https://docs.google.com/forms/d/e/1FAIpQLSe6apaA8qGkK-vIQdOevQ758g8_8MWfu2vkKeTk4dEaAyPgPA/formResponse';
};

function startTimer(){
  timeLeft=15; warned=false;
  timerLabel.textContent=timeLeft;
  timerLabel.classList.remove("red");
  timerId=setInterval(()=>{
    timeLeft--;
    timerLabel.textContent=timeLeft;

    // 5ç§’ä»¥ä¸‹ã§èµ¤ãç‚¹ç¯
    if(timeLeft<=5){
      timerLabel.classList.add("red");
      if(timeLeft===5 && !warned){
        warnSound.play();
        warned=true;
      }
    }

    if(timeLeft<=0){
      clearInterval(timerId);
      endGame(true);
    }
  },1000);
}

function flip(selected){
  if(animating)return;
  choice=selected;
  coinResult=Math.random()<0.5?"è¡¨":"è£";
  animating=true;animProgress=0;
  messageLabel.textContent="ã‚³ã‚¤ãƒ³ã‚’æŠ•ã’ã¦ã„ã¾ã™...";
}

function updateUI(){
  moneyLabel.textContent=points;
  countLabel.textContent=count;
}

function endGame(timeup=false){
  clearInterval(timerId);
  show('result');
  if(timeup)document.getElementById('timeup-msg').style.display='block';
  const rate=count===0?0:Math.round((winCount/count)*100);
  document.getElementById('result-count').textContent=count;
  document.getElementById('result-win').textContent=winCount;
  document.getElementById('result-lose').textContent=loseCount;
  document.getElementById('result-money').textContent=points;
  document.getElementById('result-rate').textContent=rate;
}

// ğŸ® ã‚³ã‚¤ãƒ³ãƒˆã‚¹æç”»
new p5((s)=>{
  s.setup=()=>{s.createCanvas(s.windowWidth*0.8,200).parent('p5target');s.textAlign(s.CENTER,s.CENTER);s.textStyle(s.BOLD);}
  s.windowResized=()=>{s.resizeCanvas(s.windowWidth*0.8,200);}
  s.draw=()=>{s.clear();
    if(animating){
      animProgress++;
      const angle=(animProgress*10)%360;
      const scaleX=Math.abs(Math.cos(angle*Math.PI/180));
      if(scaleX<0.05){face=(face==='è¡¨')?'è£':'è¡¨';}
      drawFace(face,angle);
      if(animProgress>60){
        animating=false;
        const isWin=(choice===coinResult);
        let resultText="";
        if(isWin){
          winCount++;
          let r=Math.random()*100;
          let reward=0;
          if(r<1){reward=10;}
          else if(r<80.5){reward=1;}
          else{reward=3;}
          points+=reward;
          resultText=`çµæœ:${coinResult}ï¼å½“ãŸã‚Š +${reward}pt`;
        }else{
          loseCount++;
          resultText=`çµæœ:${coinResult}ï¼ã¯ãšã‚Œ`;
        }
        count++;
        messageLabel.textContent=resultText;
        updateUI();
      }
    }else{drawFace(face,0);}
  };
  function drawFace(f,angle){
    const scaleX=Math.abs(Math.cos(angle*Math.PI/180));
    s.push();s.translate(s.width/2,s.height/2);s.scale(scaleX,1);
    s.textSize(80);s.text(f,0,0);s.pop();
  }
});
</script>
</body>
</html>
